## E-Data ##
Скрипт дозволяє отримувати дані за запитами до API з Єдиного веб-порталу використання публічних коштів та зберігати їх у наступних форматах:

* CSV
* JSON
* XML

Оскільки скрипт написано на Python, він працюватиме під усіма [операційними ситемами](https://www.python.org/downloads/operating-systems/), для яких реалізовано інтерпретатор.

Щодо особлвостей запуску під окремими операційними системами зверніться до відповідної документації мови Python для цих систем:

* [Windows](https://docs.python.org/3.3/using/windows.html)
* [Mas OS X](https://docs.python.org/3.3/using/mac.html)

### Вимоги ###
Для роботи скрипта потрібен Python версії не нижче 3.4 (теоретично повинен працювати на усіх версіях третьої гілки, але це не перевірялося). 

Скрипт використовує бібліотеку  Requests ([сторінка](https://github.com/kennethreitz/requests) на GitHub, [сторінка](https://pypi.python.org/pypi/requests) у каталозі PyPi, [документація](http://docs.python-requests.org/en/master/)).

Більш досвідченим користувачам можливо буде зручніше використовувати [віртуальне оточення](http://docs.python-guide.org/en/latest/dev/virtualenvs/).


### Отримання та встановлення ###

Отримати скрипт можна кількома шляхами:

* завантажити останню версію за [прямим посиланням](https://raw.githubusercontent.com/ap-Codkelden/edata/master/edata.py)
* завантажити [ZIP-архів](https://github.com/ap-Codkelden/edata/archive/master.zip) репозиторію 
* [клонувати](https://git-scm.com/book/it/v2/Git-Basics-Getting-a-Git-Repository#Cloning-an-Existing-Repository) даний репозиторій

Встановлення скрипт не потребує, головне — запам'ятати директорію, у яку буде збережено файл `edata.py`.

### Запуск ###

Особливості запуску залежать від використовуваної операційної системи, тому у випадку, якщо ви не знаєте, як краще це зробити, радимо звернутися до відповідної документації вище.

Якщо файл скрипта не є виконуваним, запуск відбувається стандартним для мови Python шляхом:

```python
python edata.py [параметри]
```

#### Параметри командного рядка ####

Отримати коротку довідку можна, запустивши скрипт без параметрів, або з параметром `-h` (або  `--help`):

```python
python edata.py [-h] | [--help]
```
*Хоча скрипт використовує як короткі опціі командного рядка, так і відповідні їм довгі, далі у прикладах будуть використовуватися короткі.*

##### Обов'язкові #####

Обов'язковими параметрами запуску є наявність формату виводу та коди палтників і оримувачів:

* `-j` для JSON з ім'ям `edata.json`
* `-c` для CSV з ім'ям `edata.csv`
* `-sql` для зберігання даних у [базу даних SQLite](https://en.wikipedia.org/wiki/SQLite) `edata.sqlite`, що дозволятиме згодом виконувати запити SQL

При зберіганні файлів JSON та CSV файли з такими назвами, що існують, буде перезаписано, а при зберіганні у базу даних SQLite буде або створено нову базу даних (якщо її не існує), ябо буде додано у існуючу.

Коди отримувачів *або* платників (параметри командного рядка `-p` або `-r`) вказуються через пробіл:

```python
python edata.py -j -p 00130850 13648033
```
або

```python
python edata.py -r 23359034 20077720
```

##### Опціональні #####

Відповідно до [документації](http://www.minfin.gov.ua/uploads/redactor/files/e-data-API.pdf) API, можливо вказувати початкову та кінцеву дату пошуку (як разом, так і окремо) транзакцій (параметри `-s` та `-e` відповідно). Дати можливо вказувати у двох форматах:

* `dd.mm.yyyy`
* `dd-mm-yyyy`

```python
python edata.py -p 00130850 13648033 -j -s 01.02.2015 -e 03-10-2015
python edata.py -p 00130850 13648033 -s 01.02.2015
```

У випадку, якщо діапазон дат не вказано, система самостійно визначає діапазон дат. Так, при запуску скрипта 16 жовтня 2016 року транзакції повернуто за період з 15.09.2015 по 16.10.2016.

Якщо користувачем буде сказано як початкову, так і кінцеву дату і при цьому кінцева дата виявиться меншою за пчаткову, в такому випадку дати буде поміняно місцями.

Параметр `-t` дозволяє вказати перелік регіональних казначейств, для яких буде виконуватись пошук транзакцій. Коди обласних казначейств відповідать [кодам областей України](https://docs.google.com/spreadsheets/d/1tRlvK6Kjuds1y3WzZSXzAUXfxSw6VRAuMhLpbi83Y-8/edit?usp=sharing) і співпадають з кодами головних управлінь ДФС в цих  областях (не плутати з **K_DFM11**). 

```python
python edata.py -p 00130850 13648033 -j -t 2 9 
```

### TODO ###
- [ ] з'ясувати механізм роботи та додати обробку параметра `lastload`, який повертає дату повного завантаження транзакцій (які іноді додаються частинами протягом дня)
- [ ] реалізувати можливість зберігання файлів JSON та CSV під довільними іменами
- [ ] реалізуваити можливість стиснення файлів у `bzip`, `gzip` або інший архівний формат

### Помилки ###

У разі виявлення помилок або бажання нових фіч вітається [відкриття](https://github.com/ap-Codkelden/edata/issues/new) issues.
